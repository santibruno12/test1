---
tags: ['4']
---
#  Como hacer una recarga


##### Uno de nuestros principales métodos es la recarga virtual de productos, para ésto se utiliza el método /sales/topup modificando los datos en el "Request" según la recarga que necesiten realizar.



#
##  Obtener ID de producto


El primer paso para hacer una recarga es obtener el ID del producto que desea utilizar (Personal, DirecTV, Sube, etc.)

Esto lo haremos a traves del método **[/products](https://apidoc.traxion.com.ar/docs/Documentacion/swagger.yaml/paths/~1products/get)**, el cual devuevle todos los productos disponibles con sus montos mínimos y máximos, entre otros datos. Necesitaremos guardar el ID del producto que se va a consumir.

**Ejemplo Response**

```json
[
  {
    "id": "7CD008734CB91C54A100",
    "code": "256",
    "skuCode": "5701234567899",
    "enable": true,
    "name": "DirecTV",
    "smallDescription": "Recarga DirecTv",
    "description": "IMPORTANTE - Para ingresar la operacion se debe utilizar el codigo de  18  digitos de la tarjeta. Los montos de recarga permitidos son desde $150 hasta $2000",
    "productGroup": {
      "id": "3B26087384811DD52425",
      "code": "Recharge",
      "name": "Recargas",
      "parentCategoryId": "Recargas",
      "imageUrl": "https://cajavecina.gisgeoresearch.com/assets/images/icons/recargar_celular.png",
      "description": "Productos de Recarga Virtuales"
    },
    "productType": {},
    "vendor": {
      "id": "3B26087384811DD52425",
      "code": "000418",
      "name": "DirectTv",
      "description": "DirecTv S.A.",
      "imageUrl": "gv/externalFiles/dtv-logo.jpg"
    },
    "maxDigits": "0,10,10",
    "initialValues": "10",
    "minimium": 150,
    "maximium": 2000,
    "salePrice": 270,
    "fractionalAmount": 10,
    "imageUrl": "https://cdn.telerecargas.com.ar/gvp/gv/externalFiles/dtv-logo.jpg",
    "transactionDataLabel": "Ingrese numero medidor",
    "transactionDataClassName": "CodeData"
  }
]
```


## Cómo se estructura una recarga


### Request

Al utilizar este método se debe tener en cuenta ingresar en el Header los datos detallados en el método login.

Nombre | Dato | Descripcion
---------|----------|---------
 transactionType | Tipo de transaccion | Determina el tipo de transaccion a realizar
 amount | Monto | Este monto podra ser un numero entero o decimal
 clientTransactionId | ID unico de  transaccion | Este es el ID de la transaccion (debe ser único)
 product | Producto | En el caso del producto, debemos enviar el **ID** del producto a utilizar (el cual se obtiene con el método **[/products](https://apidoc.traxion.com.ar/docs/Documentacion/swagger.yaml/paths/~1products/get)**)
 transactionData |  dato transaccional | Identifica al abonado a quien se le asignará la carga virtual. La misma posee un formato definido según el tipo de recarga, en este caso, el numero de telefono en **String**


**Ejemplo**

```json
{
  "transactionType": "string",
  "amount": integer / float ,
  "clientTransactionId": "string",
  "product": {
    "id": "string"
  },
  "transactionData": {
    "phoneNumber": "string"
  }
}

```

### Response

Las transacciones obtienen una respuesta la cual contiene datos importantes. Sin ir mas lejos, el primer dato que aparece es el ID de la transaccion, este dato debera tenerse en cuenta ya que posteriormente se utilizara en algunos metodos como obtencion de recibos o estado de la transaccion.

Sin embargo el dato mas importante del response es el Estado. Este puede ser aprobado, pendiente o rechazado. 

En el caso que sea **aprobado** la transaccion quedaria finalizada de manera correcta.
```json
{
    "id": "2D0628BF19DB2658146F",
    "number": 743696874,
    "created": "2021-04-15T16:19:12-03:00",
    "confirmationDate": "2021-04-15T16:19:13-03:00",
    "amount": 10.00,
    "description": "Recarga - 743696874",
    "state": "approved",
    "stateDetail": {
        "message": "Confirmada",
        "transactionType": "Sale"
    },
    "transactionType": "Sale",
    "clientTransactionId": "6959a1f5-7eef-4a84-b11ea3-281b2fff7e02",
    "confirmationId": "3795956353",
    "product": {
        "id": "7CD004AC7E3F24B347F5",
        "description": "RECARGA VIRTUAL PERSONAL\r\n/ Montos de Recarga: Mín $5 hasta Máx $1000\r\n/ Consulta saldo: *150# desde su celular\r\n/ Atención al Cliente de Telecom: *111",
        "name": "Personal",
        "code": "000401",
        "enable": true,
        "smallDescription": "Personal",
        "vendor": {
            "id": "3B2606CC0A29050D156B",
            "description": "Personal",
            "name": "Personal",
            "code": "000286",
            "enable": true,
            "imageUrl": "gv/logoPersonal.png"
        },
        "productGroup": {
            "id": "59846EDCB6DB34B00FEB",
            "description": "Recargas",
            "name": "Recargas",
            "code": "010978",
            "enable": true
        },
        "minimium": 5,
        "maximium": 1000,
        "imageUrl": "gv/logoPersonal.png",
        "productType": "Recharge",
        "transactionDataClassName": "PhoneData",
        "salePrice": 1.00000000
    },
    "transactionData": {
        "id": "20C928BF19DC2AADFA9C",
        "className": "PhoneData",
        "countryCode": "54",
        "phoneNumber": "1111110001",
        "msisdn": "541111110001"
    }
}
```

En el caso del estado de **anulada/rechazado**, este vera un motivo reflejado en el response de porque esta transaccion no pudo realizarse correctamente.


```json
{
    "id": "2D066C9165C20690F379",
    "number": 743696938,
    "created": "2021-04-20T14:22:52-03:00",
    "amount": 10.00,
    "description": "Recarga - 743696938",
    "state": "rejected",
    "stateDetail": {
        "message": "Errores por categorias",
        "transactionType": "Sale"
    },
    "transactionType": "Sale",
    "clientTransactionId": "6959a1f5-7eef-4a84-1e1b2fff2",
    "product": {
        "id": "7CD004AC7E3F24B347F5",
        "description": "RECARGA VIRTUAL PERSONAL\r\n/ Montos de Recarga: Mín $5 hasta Máx $1000\r\n/ Consulta saldo: *150# desde su celular\r\n/ Atención al Cliente de Telecom: *111",
        "name": "Personal",
        "code": "000401",
        "enable": true,
        "smallDescription": "Personal",
        "vendor": {
            "id": "3B2606CC0A29050D156B",
            "description": "Personal",
            "name": "Personal",
            "code": "000286",
            "enable": true,
            "imageUrl": "gv/logoPersonal.png"
        },
        "productGroup": {
            "id": "59846EDCB6DB34B00FEB",
            "description": "Recargas",
            "name": "Recargas",
            "code": "010978",
            "enable": true
        },
        "minimium": 5,
        "maximium": 1000,
        "imageUrl": "gv/logoPersonal.png",
        "productType": "Recharge",
        "transactionDataClassName": "PhoneData",
        "salePrice": 1.00000000
    },
    "transactionData": {
        "id": "20C96C9165C31D75EFF8",
        "className": "PhoneData",
        "countryCode": "54",
        "phoneNumber": "1111122222",
        "msisdn": "541111122222"
    }
}
```


Por ultimo, el estado pendiente. A diferencia de los estados finales comentados anteriormente, en el caso de que quede en estado pendiente se debera realizar una comprobacion con un metodo hasta que se obtenga como respuesta que la transaccion llego a un estado final (rechazada o aprobada).
Esto lo realizaremos con el metodo [/sale/{id}](https://apidoc.traxion.com.ar/docs/Documentacion/swagger.yaml/paths/~1sale~1%7Bid%7D/get) el cual explicaremos en "[Obtener Estado de la transaccion](https://apidoc.traxion.com.ar/docs/Documentacion/docs/introduccion/4.-Recargas.md#obtener-estado-de-la-transaccione)"



##  Recargas identificadas por numero de telefono

Cada compañia telefonica (la cual se encuentra disponible para hacer recarga) posee distinto ID el cual debemos modificar dependiendo la que se desee hacer. 

Ademas, deberan enviar el numero de telefono como string dentro del dato "phoneNumber" el cual debe cumplir con lo siguiente:

Se informa el país, el código de área, sin incluir el 0 y el número de línea.
(Si no se informa el prefijo de país, se asume +54, Argentina)

Ej 1: Área 011 y número 12345678: se informa, CodigoArea:11 NumeroTelefono: 12345678.   

Ej 2: Área 02965 y número 123456: se informa, CodigoArea: 2965 NumeroTelefono: 123456



```json
{
  "transactionType": "Sale",
  "amount": 10,
  "clientTransactionId": "6959a1f5-7eef-4a84-bea3-281b2fff7e02",
  "product": {
    "id": "7CD004AC7E3F24B347F5"
  },
  "transactionData": {
    "phoneNumber": "1111110001"
  }
}

```

##  Recargas identificadas por codigo de cliente, servicio, etc

Para recargas de servicios se necesita el ID del producto ademas del codigo que se requiera en cada caso, este lo enviaremos a traves del dato "code", el cual debera cumplir con lo siguiente:

Ejemplo para DirectV/Antina:
123456789123-456789: se informa, (datosRecarga): 123456789123456789

Ejemplo para Edenor Prepago:
07012345678: se informa, (datosRecarga): 07012345678  (corresponde al nro. de medidor)






```json
{ 
  "transactionType": "Sale",  
  "amount": 160.0,    
  "clientTransactionId": "444551",
  "product": {
      "id": "7CD012091DEF1C47B332"
  },
  "transactionData": {
      "code": "1234123412340123"
  }
}


```
##  Recargas SUBE

Esta recarga es muy similar a las "Recargas identificadas por codigo", Deberiamos cologar el ID de SUBE en el request con su codigo en string en el dato "code" el cual debe cumplir con lo siguiente :

Ejemplo para SUBE Diferido:
1234567891234567: se informa, (datosRecarga): 1234567891234567 (corresponde al nro. de tarjeta de 16 dígitos)


```json
{ 
  "transactionType": "Sale",  
  "amount": 160.0,    
  "clientTransactionId": "444551",
  "product": {
      "id": "7CD012091DEF1C47B332"
  },
  "transactionData": {
      "code": "1234123412340123"
  }
}


```
##  Recargas con identificacion por cliente y codigo de seguridad

En el caso de esta recarga se requeiren 2 datos, un numero de conductor (el cual enviaremos como "code") y el DNI del conductor (el cual enviaremos como "securityCode")

En el caso del DNI (securityCode) se debera cumplir con lo siguiente:
(DNI = 1, LC = 2 y LE = 3) con el número de documento.
Ejemplo:
DNI 12.345.678: se informa 112345678
LE 123.456: se informa, (datosRecarga): 3123456



```json
{
    "transactionType": "Sale",
    "amount": 70,
    "clientTransactionId": "111101",
    "product": {
        "id": "7CD06C9157D40FCBA6B7"
    },
    "transactionData": {
        "code": "1154192126",
        "securityCode": "111111111"
    }
}
```

##  Recargas Estacionamiento
En las recargas de estacionamientos es un poco mas complejas en algunos casos ya que enviaremos mas de un dato. Explicaremos que hacer en cada caso a continuacion

### Recarga de cuenta
En el caso de la Recarga de cuenta de estacionamiento, Se realizara de una manera similiar a las "recargas telefonicas" ya que este requiere como dato un "PhoneNumber" el cual esta relacionado a la cuenta a recargar.

Este "phoneNumber" debe cumplir con lo siguiente:
Se informa el país, el código de área, sin incluir el 0 y el número de línea.
(Si no se informa el prefijo de país, se asume +54, Argentina)

Ej 1: Área 011 y número 12345678: se informa, CodigoArea:11 NumeroTelefono: 12345678.   

Ej 2: Área 02965 y número 123456: se informa, CodigoArea: 2965 NumeroTelefono: 123456



```json
{
  "transactionType": "Sale",
  "amount": 70,
  "clientTransactionId": "10132121",
  "product": {
      "id": "7CD04142BB4D07F9D3FA"
  },
  "transactionData": {
      "phoneNumber": "1111110111"
    }
}
```
### Multas
El request de las multas requiere 2 datos a enviar, por un lado la patente (la cual enviaremos como "domain") y por otro lado el codigo de acta (el cual enviaremos como actCode)

```json
{
  "transactionType": "Sale",
  "amount": 250,
  "clientTransactionId": "1844",
  "product": {
      "id": "7CD041429CDD332AEF17"
    },
  "transactionData": {        
      "domain": "ABC123", 
      "actCode": "1234"
    }
}
```

### Estacionamiento x hora
Para realizar una recarga del tipo "estacionamiento por tiempo" debemos tener en cuenta q requiere 2 datos, la patente (la cual enviaremos como domain) y el tiempo. En el caso de ser un estacionamiento por hora, enviaremos el dato "hour" con la cantidad de horas.

```json
{
    "transactionType": "Sale",
    "amount": 100,
    "clientTransactionId": "101",
    "product": {
        "id": "7CD0414272DD13DEF60B"
    },
    "transactionData": {
        "domain": "ABC123",
        "hour": 2
    }
}
```

### Estacionamiento Fraccionado
Al igual que el "estacionamiento x hora" este requiere los mismos 2 datos (patente y tiempo) pero a diferencia de el anterior, enviaremos "domain" (para patente) y "fraction" para tiempo. Para este ultimo dato debera tenerse en cuenta que el numero debe ser multiplo de 30 (30,60,90,etc) ya que se trata de minutos

```json
{
    "transactionType": "Sale",
    "amount": 100,
    "clientTransactionId": "101",
    "product": {
        "id": "7CD0414272DD13DEF60B"
    },
    "transactionData": {
        "domain": "ABC123",
        "fraction": 60
    }
}
```
## Obtener recibo de la transaccion

Obtener el recibo de la transaccion es algo muy sencillo, lo necesario para este metodo es poseer el ID que se encuentra en la respuesta al generar la transaccion. Con ese id utilizaremos el metodo [/sale/{id}/receipt](https://apidoc.traxion.com.ar/docs/Documentacion/swagger.yaml/paths/~1sale~1%7Bid%7D~1receipt/get) colocando el id guardado de la siguiente forma: ** /sale/2D06714504BD3B177843/receipt**


## Obtener Estado de la transaccion
Al igual que  el recibo, para obtener el estado de la transaccion se usa un metodo que  requiere el **ID** para utilizarlo. El metodo seria [/sale/{id}](https://apidoc.traxion.com.ar/docs/Documentacion/swagger.yaml/paths/~1sale~1%7Bid%7D/get) 

Debera seguir los pasos que indicamos en la  [estructura de la recarga](https://apidoc.traxion.com.ar/docs/Documentacion/docs/introduccion/4.-Recargas.md#response)





